<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Commands</title>
<style>
  /* --- Reset & base --- */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 50px 10%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212;
    color: #ddd;
    user-select: none;
  }
  h1 {
    margin-bottom: 30px;
    font-weight: 700;
  }
  /* --- Header --- */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
  }
  #searchBox {
    padding: 8px 14px;
    font-size: 14px;
    border-radius: 10px;
    border: none;
    background-color: #1f1f1f;
    color: #eee;
    width: 280px;
    outline-offset: 2px;
    outline-color: #5865f2;
    user-select: text;
  }
  #searchBox::placeholder {
    color: #666;
  }
  /* --- Modules bar container --- */
  .modules-bar-container {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 30px;
  }
  /* --- Arrow buttons --- */
  .arrow-btn {
    background-color: #1f1f1f;
    border: none;
    color: #888;
    padding: 8px 14px;
    font-size: 18px;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s, color 0.2s;
  }
  .arrow-btn:hover:not(:disabled) {
    background-color: #3a3a3a;
    color: #fff;
  }
  .arrow-btn:disabled {
    opacity: 0.3;
    cursor: default;
  }
  /* --- Modules bar --- */
  .modules-bar {
    overflow: hidden;
    flex-grow: 1;
  }
  .modules-list {
    display: flex;
    gap: 12px;
    transition: transform 0.3s ease;
    will-change: transform;
  }
  /* --- Module buttons --- */
  .nav-button {
    background-color: #1f1f1f;
    color: #888;
    border: none;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: background-color 0.25s, color 0.25s;
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 110px;
    justify-content: center;
    user-select: none;
    white-space: nowrap;
  }
  .nav-button.active {
    background-color: #3a3a3a;
    color: #fff;
    font-weight: 600;
  }
  .nav-button .count {
    background: #444;
    border-radius: 10px;
    padding: 0 8px;
    font-size: 12px;
    color: #bbb;
    user-select: none;
  }
  /* --- Command Grid --- */
  .command-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }
  .command-card {
    background-color: #1f1f1f;
    border-radius: 12px;
    padding: 20px 20px 24px 20px;
    box-shadow: 0 0 6px #222;
    transition: box-shadow 0.2s;
    user-select: text;
  }
  .command-card:hover {
    box-shadow: 0 0 16px #5865f2;
  }
  .command-name {
    font-weight: 700;
    font-size: 17px;
    color: #eee;
    margin-bottom: 6px;
  }
  .command-desc {
    font-size: 13.5px;
    color: #aaa;
    margin-bottom: 16px;
    min-height: 40px;
  }
  .label {
    font-size: 10px;
    font-weight: 600;
    color: #666;
    letter-spacing: 1.1px;
    text-transform: uppercase;
    margin-bottom: 6px;
    user-select: none;
  }
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 14px;
  }
  .tag {
    background-color: #333;
    color: #bbb;
    padding: 5px 11px;
    border-radius: 12px;
    font-size: 12px;
    user-select: none;
    white-space: nowrap;
  }
  /* --- Responsive --- */
  @media (max-width: 980px) {
    .command-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (max-width: 620px) {
    .command-grid {
      grid-template-columns: 1fr;
    }
    #searchBox {
      width: 100%;
      margin-top: 12px;
    }
  }
</style>
</head>
<body>

<div class="header">
  <h1>Commands</h1>
  <input type="search" id="searchBox" placeholder="Search commands..." autocomplete="off" />
</div>

<div class="modules-bar-container">
  <button class="arrow-btn" id="leftArrow" title="Scroll Left" aria-label="Scroll Left" disabled>←</button>
  <div class="modules-bar" id="modulesBar" aria-label="Command Categories">
    <div class="modules-list" id="modulesList">
      <!-- Module buttons injected here -->
    </div>
  </div>
  <button class="arrow-btn" id="rightArrow" title="Scroll Right" aria-label="Scroll Right" disabled>→</button>
</div>

<div class="command-grid" id="commandGrid">
  <!-- Command cards injected here -->
</div>

<script>
(async function() {
  const modulesList = document.getElementById('modulesList');
  const commandGrid = document.getElementById('commandGrid');
  const searchBox = document.getElementById('searchBox');
  const leftArrow = document.getElementById('leftArrow');
  const rightArrow = document.getElementById('rightArrow');
  const modulesBar = document.getElementById('modulesBar');

  // Load commands JSON
  let commandsJSON;
  try {
    const resp = await fetch('./commands.json');
    commandsJSON = await resp.json();
  } catch(e) {
    commandGrid.innerHTML = '<p style="color:#f55;">Failed to load commands.json</p>';
    console.error(e);
    return;
  }

  // Extract modules (categories)
  const modules = Object.keys(commandsJSON).sort();

  // Setup module buttons with counts, including "All"
  const MODULES_VISIBLE = 3; // Number of modules visible at once

  // Create module buttons + "All"
  function createModuleButtons() {
    modulesList.innerHTML = '';

    // Create "All" module button
    const allBtn = createModuleBtn('All', 'all', modules.reduce((acc, mod) => acc + commandsJSON[mod].length, 0));
    allBtn.classList.add('active');
    modulesList.appendChild(allBtn);

    // Create individual module buttons
    for (const mod of modules) {
      const btn = createModuleBtn(mod, mod, commandsJSON[mod].length);
      modulesList.appendChild(btn);
    }
  }

  function createModuleBtn(text, modName, count) {
    const btn = document.createElement('button');
    btn.className = 'nav-button';
    btn.textContent = text;
    btn.dataset.module = modName;
    // Add count badge
    const countSpan = document.createElement('span');
    countSpan.className = 'count';
    countSpan.textContent = count;
    btn.appendChild(countSpan);

    btn.addEventListener('click', () => {
      setActiveModule(modName);
      renderCommands(modName);
      updateArrows();
    });

    return btn;
  }

  // Track currently active module/category
  let activeModule = 'all';

  function setActiveModule(modName) {
    activeModule = modName;
    document.querySelectorAll('.nav-button').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.module === modName);
    });
  }

  // Render commands filtered by module & search
  function renderCommands(moduleFilter = 'all') {
    const searchTerm = searchBox.value.trim().toLowerCase();
    commandGrid.innerHTML = '';

    // Gather commands for filter
    let filteredCommands = [];
    if (moduleFilter === 'all') {
      for (const mod of modules) filteredCommands = filteredCommands.concat(commandsJSON[mod]);
    } else {
      filteredCommands = commandsJSON[moduleFilter] ?? [];
    }

    // Filter by search
    if (searchTerm) {
      filteredCommands = filteredCommands.filter(cmd => {
        return (cmd.name && cmd.name.toLowerCase().includes(searchTerm))
            || (cmd.description && cmd.description.toLowerCase().includes(searchTerm));
      });
    }

    if (filteredCommands.length === 0) {
      commandGrid.innerHTML = `<p style="color:#888;">No commands found.</p>`;
      return;
    }

    for (const cmd of filteredCommands) {
      const card = document.createElement('div');
      card.className = 'command-card';

      // Name
      const nameEl = document.createElement('div');
      nameEl.className = 'command-name';
      nameEl.textContent = cmd.name || '(Unnamed)';
      card.appendChild(nameEl);

      // Description
      if (cmd.description) {
        const descEl = document.createElement('div');
        descEl.className = 'command-desc';
        descEl.textContent = cmd.description;
        card.appendChild(descEl);
      }

      // Arguments
      let args = [];

      if (cmd.syntax) {
        const regex = /[<\[]([^>\]]+)[>\]]/g;
        let match;
        while ((match = regex.exec(cmd.syntax)) !== null) args.push(match[1]);
      }
      if (args.length === 0 && cmd.example) {
        args = cmd.example.split(/\s+/).filter(x => x && x.toLowerCase() !== 'none');
      }

      if (args.length > 0) {
        const argLabel = document.createElement('div');
        argLabel.className = 'label';
        argLabel.textContent = 'Arguments';
        card.appendChild(argLabel);

        const argTags = document.createElement('div');
        argTags.className = 'tags';
        args.forEach(a => {
          const tag = document.createElement('div');
          tag.className = 'tag';
          tag.textContent = a;
          argTags.appendChild(tag);
        });
        card.appendChild(argTags);
      }

      // Permissions
      if (cmd.permissions) {
        const permLabel = document.createElement('div');
        permLabel.className = 'label';
        permLabel.textContent = 'Permissions';
        card.appendChild(permLabel);

        const permTags = document.createElement('div');
        permTags.className = 'tags';

        // If permissions is array, show multiple tags, else single
        if (Array.isArray(cmd.permissions)) {
          cmd.permissions.forEach(p => {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.textContent = p;
            permTags.appendChild(tag);
          });
        } else {
          const tag = document.createElement('div');
          tag.className = 'tag';
          tag.textContent = cmd.permissions;
          permTags.appendChild(tag);
        }
        card.appendChild(permTags);
      }

      commandGrid.appendChild(card);
    }
  }

  // --- Modules bar scrolling ---
  // The modulesList is flex, scroll via transform translateX by fixed amount per click

  let currentScrollIndex = 0; // how many modules scrolled from left (in module units)
  const moduleBtnWidth = 128; // Approx width of each module button (including gap)
  // We'll update after render buttons, just initial guess

  function updateArrowButtons() {
    const maxIndex = Math.max(0, modulesList.children.length - MODULES_VISIBLE);
    leftArrow.disabled = currentScrollIndex <= 0;
    rightArrow.disabled = currentScrollIndex >= maxIndex;
  }

  function updateModulesTransform() {
    const offset = -currentScrollIndex * moduleBtnWidth;
    modulesList.style.transform = `translateX(${offset}px)`;
  }

  // On arrow clicks:
  leftArrow.addEventListener('click', () => {
    currentScrollIndex = Math.max(0, currentScrollIndex - MODULES_VISIBLE);
    updateModulesTransform();
    updateArrowButtons();
  });
  rightArrow.addEventListener('click', () => {
    const maxIndex = Math.max(0, modulesList.children.length - MODULES_VISIBLE);
    currentScrollIndex = Math.min(maxIndex, currentScrollIndex + MODULES_VISIBLE);
    updateModulesTransform();
    updateArrowButtons();
  });

  // After module buttons are created, calculate button width dynamically:
  function recalcModuleBtnWidth() {
    if (modulesList.children.length === 0) return;
    // Get first button width + gap
    const style = getComputedStyle(modulesList.children[0]);
    const marginRight = parseFloat(style.marginRight) || 0;
    moduleBtnWidth = modulesList.children[0].offsetWidth + marginRight;
  }

  // Initialize modules
  createModuleButtons();
  recalcModuleBtnWidth();
  updateModulesTransform();
  updateArrowButtons();

  // Render all commands initially
  renderCommands();

  // Search box filters commands live
  searchBox.addEventListener('input', () => {
    renderCommands(activeModule);
  });

  // Accessibility: Allow arrow keys to navigate modules
  modulesBar.addEventListener('keydown', e => {
    if (e.key === 'ArrowLeft') leftArrow.click();
    else if (e.key === 'ArrowRight') rightArrow.click();
  });
})();
</script>

</body>
</html>
