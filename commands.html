<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Commands</title>
<style>
  /* --- Reset & base --- */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 50px 10%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212;
    color: #ddd;
    user-select: none;
  }
  h1 {
    margin-bottom: 30px;
    font-weight: 700;
  }
  /* --- Header & Nav --- */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 30px;
  }
  .nav-categories {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .nav-button {
    background-color: #1f1f1f;
    color: #888;
    border: none;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: background-color 0.25s, color 0.25s;
    display: flex;
    align-items: center;
    gap: 6px;
    user-select: none;
  }
  .nav-button.active {
    background-color: #3a3a3a;
    color: #fff;
    font-weight: 600;
  }
  .nav-button .count {
    background: #444;
    border-radius: 10px;
    padding: 0 8px;
    font-size: 12px;
    color: #bbb;
  }
  /* --- Search --- */
  #searchBox {
    padding: 8px 14px;
    font-size: 14px;
    border-radius: 10px;
    border: none;
    background-color: #1f1f1f;
    color: #eee;
    width: 280px;
    outline-offset: 2px;
    outline-color: #5865f2;
    user-select: text;
  }
  #searchBox::placeholder {
    color: #666;
  }
  /* --- Command Grid --- */
  .command-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 20px;
  }
  .command-card {
    background-color: #1f1f1f;
    border-radius: 12px;
    padding: 20px 20px 24px 20px;
    box-shadow: 0 0 6px #222;
    transition: box-shadow 0.2s;
    user-select: text;
  }
  .command-card:hover {
    box-shadow: 0 0 16px #5865f2;
  }
  .command-name {
    font-weight: 700;
    font-size: 17px;
    color: #eee;
    margin-bottom: 6px;
  }
  .command-desc {
    font-size: 13.5px;
    color: #aaa;
    margin-bottom: 16px;
    min-height: 40px;
  }
  .label {
    font-size: 10px;
    font-weight: 600;
    color: #666;
    letter-spacing: 1.1px;
    text-transform: uppercase;
    margin-bottom: 6px;
    user-select: none;
  }
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 14px;
  }
  .tag {
    background-color: #333;
    color: #bbb;
    padding: 5px 11px;
    border-radius: 12px;
    font-size: 12px;
    user-select: none;
    white-space: nowrap;
  }
  /* --- Responsive --- */
  @media (max-width: 600px) {
    body {
      padding: 40px 6%;
    }
    #searchBox {
      width: 100%;
      margin-top: 12px;
    }
    .header {
      flex-wrap: wrap;
      gap: 12px;
    }
  }
</style>
</head>
<body>

<div class="header">
  <h1>Commands</h1>
  <input type="search" id="searchBox" placeholder="Search commands..." autocomplete="off" />
</div>

<div class="nav-categories" id="categoryNav">
  <!-- Dynamically filled -->
</div>

<div class="command-grid" id="commandGrid">
  <!-- Dynamically filled -->
</div>

<script>
(async function() {
  const commandGrid = document.getElementById('commandGrid');
  const categoryNav = document.getElementById('categoryNav');
  const searchBox = document.getElementById('searchBox');

  // Load JSON file
  let commandsJSON;
  try {
    const resp = await fetch('./commands.json');
    commandsJSON = await resp.json();
  } catch(e) {
    commandGrid.innerHTML = '<p style="color:#f55;">Failed to load commands.json</p>';
    console.error(e);
    return;
  }

  // Parse JSON: keys = modules, values = array of commands
  const modules = Object.keys(commandsJSON).sort();

  // Create category buttons + "All"
  function createCategoryButtons() {
    // Clear old
    categoryNav.innerHTML = '';

    // "All" button
    const allBtn = document.createElement('button');
    allBtn.textContent = 'All';
    allBtn.className = 'nav-button active';
    allBtn.dataset.module = 'all';
    allBtn.addEventListener('click', () => {
      setActiveCategory('all');
      renderCommands();
    });
    categoryNav.appendChild(allBtn);

    // Per module buttons with counts
    for (const mod of modules) {
      const btn = document.createElement('button');
      btn.className = 'nav-button';
      btn.dataset.module = mod;
      btn.title = mod;
      btn.innerHTML = `${mod} <span class="count">${commandsJSON[mod].length}</span>`;
      btn.addEventListener('click', () => {
        setActiveCategory(mod);
        renderCommands(mod);
      });
      categoryNav.appendChild(btn);
    }
  }

  // Track active category and filter commands
  let activeCategory = 'all';

  function setActiveCategory(module) {
    activeCategory = module;
    // update active button styling
    document.querySelectorAll('.nav-button').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.module === module);
    });
  }

  // Render commands filtered by category & search
  function renderCommands(moduleFilter = 'all') {
    const searchTerm = searchBox.value.trim().toLowerCase();
    commandGrid.innerHTML = '';

    // Gather all commands or filtered
    let filteredCommands = [];
    if (moduleFilter === 'all') {
      for (const mod of modules) {
        filteredCommands = filteredCommands.concat(commandsJSON[mod]);
      }
    } else {
      filteredCommands = commandsJSON[moduleFilter] ?? [];
    }

    // Filter by search term on name or description
    if (searchTerm) {
      filteredCommands = filteredCommands.filter(cmd => {
        return (cmd.name && cmd.name.toLowerCase().includes(searchTerm))
            || (cmd.description && cmd.description.toLowerCase().includes(searchTerm));
      });
    }

    if (filteredCommands.length === 0) {
      commandGrid.innerHTML = `<p style="color:#888;">No commands found.</p>`;
      return;
    }

    for (const cmd of filteredCommands) {
      const card = document.createElement('div');
      card.className = 'command-card';

      // Command Name
      const nameEl = document.createElement('div');
      nameEl.className = 'command-name';
      nameEl.textContent = cmd.name || '(Unnamed)';
      card.appendChild(nameEl);

      // Description
      if (cmd.description) {
        const descEl = document.createElement('div');
        descEl.className = 'command-desc';
        descEl.textContent = cmd.description;
        card.appendChild(descEl);
      }

      // Arguments (from syntax or example)
      let args = [];

      // Try to parse args from syntax (e.g. "command <arg1> [arg2]")
      if (cmd.syntax) {
        // Extract words inside <> or []
        const regex = /[<\[]([^>\]]+)[>\]]/g;
        let match;
        while ((match = regex.exec(cmd.syntax)) !== null) {
          args.push(match[1]);
        }
      }

      // If no args from syntax, try example split (remove 'none')
      if (args.length === 0 && cmd.example) {
        args = cmd.example.split(/\s+/).filter(x => x && x.toLowerCase() !== 'none');
      }

      if (args.length > 0) {
        const argLabel = document.createElement('div');
        argLabel.className = 'label';
        argLabel.textContent = 'Arguments';
        card.appendChild(argLabel);

        const argTags = document.createElement('div');
        argTags.className = 'tags';
        args.forEach(a => {
          const tag = document.createElement('div');
          tag.className = 'tag';
          tag.textContent = a;
          argTags.appendChild(tag);
        });
        card.appendChild(argTags);
      }

      // Permissions
      if (cmd.permissions) {
        const permLabel = document.createElement('div');
        permLabel.className = 'label';
        permLabel.textContent = 'Permissions';
        card.appendChild(permLabel);

        const permTag = document.createElement('div');
        permTag.className = 'tags';
        const tag = document.createElement('div');
        tag.className = 'tag';
        tag.textContent = cmd.permissions;
        permTag.appendChild(tag);
        card.appendChild(permTag);
      }

      commandGrid.appendChild(card);
    }
  }

  // Initialize UI
  createCategoryButtons();
  renderCommands();

  // Search filter event
  searchBox.addEventListener('input', () => {
    renderCommands(activeCategory);
  });
})();
</script>
</body>
</html>
